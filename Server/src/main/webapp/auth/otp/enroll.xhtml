<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
        "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                template="/WEB-INF/incl/layout/template.xhtml">
    <f:metadata>
        <f:viewAction action="#{authenticator.prepareAuthenticationForStep}" if="#{not identity.loggedIn}"/>
    </f:metadata>

    <ui:define name="head">
        <meta name="description" content="Gluu Inc." />
        <script src="#{oxAuthConfigurationService.getJsLocation()}/jquery-1.12.4.min.js"/>
        <script src="#{oxAuthConfigurationService.getJsLocation()}/bootstrap.min.js"></script>
        <link rel="stylesheet" href="#{oxAuthConfigurationService.cssLocation}/jquery-ui-1.12.1.min.css"/>
        <script src="#{oxAuthConfigurationService.jsLocation}/jquery-1.12.4.min.js"/>
        <script src="#{oxAuthConfigurationService.jsLocation}/jquery.qrcode-0.12.0.min.js"/>
        <script src="#{oxAuthConfigurationService.jsLocation}/jquery-ui-1.12.1.min.js"/>
        <script src="../../js/gluu-auth.js"/>

        <script>
            var helper = (function() {
                var authResult = undefined;

                return {
                    /**
                     * Resume on getting authentication result from server
                     */
                    onSignInCallback: function(authResult) {
                        console.log('Get authentication result: ' + authResult);
                        helper.resumeAuthentication(authResult);
                    },

                    /**
                     * Send form to server to resume authentication workflow
                     */
                    resumeAuthentication: function(authResult) {
                        $('input#auth_result').val(authResult);
                        $('form#response').submit();
                    },
                };
            })();

            /**
             * Calls the helper method that handles the authentication flow.
             */
            function onSignInCallback(authResult) {
                helper.onSignInCallback(authResult);
            }

            var request = '${identity.getWorkingParameter('otp_enrollment_request')}';
            var label = '${identity.getWorkingParameter('qr_label')}';
            var qr_options = ${identity.getWorkingParameter('qr_options')};
            $(document).ready(function() {

                if (request == '') {
                    onSignInCallback('error');
                }

                gluu_auth.renderQrCode('#container', request, qr_options, label);
                gluu_auth.startProgressBar('#progressbar', 60, onSignInCallback);
            });

        </script>
        <style type="text/css">
            .otp-progress-bar {
                margin-right: 40px;
            }

            .otp-container {
                width: 1160px;
            }
            .body{
                width: 100%;
                margin: 0;
                padding: 0;
            }
            .footer{
                width: 100%;
                margin: 0 0 0 ;
                position: absolute;
                bottom: 0;
            }
        </style>
    </ui:define>

    <ui:define name="pageTitle">
        <h:outputText value="#{msgs['otp.pageTitle']}" />
    </ui:define>
    <ui:define name="body" style="width: 100%;margin: 0;padding: 0;">

        <form method="post" id="response" action="#{request.contextPath}/postlogin">
            <input type="hidden" id="auth_result" name="auth_result" />
        </form>


        <div class="container otp-container">
            <div id="content" class="sign-in-page">
                <div class="row-fluid">
                    <h:form id="loginForm" class="signin-form span6 offset3">
                        <h:panelGroup rendered="#{not identity.loggedIn}">
                            <div class="inner-form-container row-fluid">
                                <ul class="offset2 span10" style="list-style: none">
                                    <h:messages style="color:red;" />
                                    <div class="row-fluid">
                                        <div class="dialog col-md-12">
                                            <p style="font-weight: 800">#{msgs['otp.scanQRCode']}</p>
                                            <div id="container" class="col-md-5" ></div>
                                            <div id="" class= "col-md-6" style="margin-top: 16%">
                                                <div id="progressbar"></div>
                                                <div id="submit_block" class="login_input ">
                                                    <h:commandButton id="finishButton"  style="width: 35%;margin-top: 10px;margin-left: 37% "
                                                                     value="#{msgs['otp.finish']}"
                                                                     action="#{authenticator.authenticate}" />
                                                </div>
                                                <span class="sprite-green_click_icon"></span>
                                            </div>

                                        </div>
                                    </div>
                                    <li class="row-fluid submit-container">
                                        <div class="gradient contact-button green span2 offset3">

                                        </div>
                                    </li>
                                    <h:panelGroup rendered='#{!empty client.getPolicyUri()}'>
                                        <p>
                                            <h:outputText value="#{msgs['common.agreePolicy']}" />
                                            <a target="_blank" href='#{client.getPolicyUri()}'> <h:outputText
                                                    value="#{msgs['common.privacyPolicy']}" />
                                            </a>
                                        </p>
                                    </h:panelGroup>

                                    <h:panelGroup rendered='#{!empty client.getTosUri()}'>
                                        <p>
                                            <h:outputText value="#{msgs['common.pleaseReadTheTos']}" />
                                            <a target="_blank" href='#{client.getTosUri()}'> <h:outputText
                                                    value="#{msgs['common.termsOfService']}" />
                                            </a>
                                        </p>
                                    </h:panelGroup>
                                </ul>

                            </div>
                        </h:panelGroup>
                    </h:form>
                </div>
            </div>


        </div>

    </ui:define>
</ui:composition>
